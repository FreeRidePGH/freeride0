<style>
#bikelisttable th .current {
  padding-right: 12px;
  background-repeat: no-repeat;
  background-position: right center;
}

#bikelisttable th .asc {
	background-color: yellow;
	background: url(/images/uparrow.JPG) no-repeat right;
}

#bikelisttable th .desc {
	background-color: yellow;
	background: url(/images/downarrow.JPG) no-repeat right;	
}

#bikelisttable  {
	width: 100%;
	border-collapse:collapse;
	border:1px solid #FFCA5E;
}

#bikelisttable thead th {
	
	font-size: 13px;
	height: 30px;
	color: #FFFFFF;
	font-weight: bolder;
	padding: 0px 7px;
	margin: 20px 0px 0px;
	text-align: left;
	border-right: 1px solid #FCF1D4;
}
#bikelisttable tbody tr {
	background: url(/images/bg_td1.jpg) repeat-x top;
}
#bikelisttable tbody tr.odd {
	background: #FFF8E8 url(/images/bg_td2.jpg) repeat-x;
}

#bikelisttable tbody td {
	font-family: Arial, Helvetica, sans-serif;
	color: #565051;
	padding: 10px 7px;
	border-top: 1px solid #FFCA5E;
	border-right: 1px solid #DDDDDD;
	text-align: left;
}

</style>
<script>
function filter2 (phrase, _id){
	var words = phrase.value.toLowerCase().split(" ");
	var table = document.getElementById(_id);
	var ele;
	for (var r = 1; r < table.rows.length; r++){
		ele = table.rows[r].innerHTML.replace(/<[^>]+>/g,"");
	        var displayStyle = 'none';
	        for (var i = 0; i < words.length; i++) {
		    if (ele.toLowerCase().indexOf(words[i])>=0)
			displayStyle = '';
		    else {
			displayStyle = 'none';
			break;
		    }
	        }
		table.rows[r].style.display = displayStyle;
	}
}

function isNumberKey(evt)
{
 var charCode = (evt.which) ? evt.which : event.keyCode
 if (charCode > 31 && (charCode < 48 || charCode > 57))
	return false;

 return true;
}

</script>
<h2>Reports</h2><br/>
<form id="report" name="report" action="/bikes/reports" type="POST">

Report Type:
<select name="reportType">
<option value="Inactive Bikes" <%if @reportType=="Inactive Bikes"%>selected="selected"<%end%>>Inactive Bikes</option>
<option value="Inactive EABs" <%if @reportType=="Inactive EABs"%>selected="selected"<%end%>>Inactive EABs</option>
</select>&nbsp;&nbsp;

Period:
<input type="textbox" name="inactiveFor" size="13" value="<%=@inactiveFor%>" placeholder="No. of weeks" onkeypress="return isNumberKey(event)"/>


<input type="submit" value="Go"/><br/><br/>
</form>
<%if !@reportType.nil?%>
Showing report for: <b><%=@reportType%></b>
<%end%>&nbsp;&nbsp;
<%if !@inactiveFor.nil?%>
Period: <b><%=@inactiveFor%> weeks</b>
<%end%><br/><br/>

<%if !@bikes.nil?%>
<%if !@bikes.empty?%>
<form align="right">
	<input name="filter" placeholder="Search Current Page" onkeyup="filter2(this, 'bikelisttable')" type="text">
</form>
<br/>
<table id="bikelisttable" class="filtertable">
  <thead><tr>
		<th><a>ID</a></th>
    <th><a>Brand</a></th>		
    <th><a>Model</a></th>
    <th><a>Location</a></th>
    <th><a>Date In</a></th>
    <th><a>Status</a></th>
	<th><%if @reportType=="Inactive EABs"%><a>EAB Last Active</a><%else%><a>Last Updated</a><%end%></th>
	<th></th>
  </tr></thead><tbody>

<% @count = 0%>
<% @bikes.each do |bike| %>
<% @loc = Location.find_by_id(bike.location_id)%>

  <tr <% if @count % 2 ==0%>class="odd"<%end%> >
		<td><%= bike.bike_id %></td>
    <td><%= BikeBrand.find_by_id(bike.brand_id).name%></td>
	<td><%= BikeModel.find_by_id(bike.model_id).name %></td>
    <td><%if @loc.nil?%>
			N.A.
		<%else%>
			<%if @loc.hook_number.nil?%>
				<%=@loc.name%>
			<%else%>
				HookID - <%=@loc.hook_number%>
			<%end%>
		<%end%>			
	</td>
    <td><%= bike.date_in.year %>-<%= bike.date_in.strftime("%b")%>-<%=bike.date_in.day %></td>
    <td><%= bike.status %></td>
	<td><%if @reportType=="Inactive EABs"
			@project = EabProject.find_by_bike_id(bike.id)
			if !@project.nil?%>
				<%= @project.start_date.year%>-<%=@project.start_date.strftime("%b")%>-<%=@project.start_date.day%>
			<%end%>
			<%else%>
				<%= bike.updated_at.year%>-<%= bike.updated_at.strftime("%b")%>-<%=bike.updated_at.day%>
			<%end%></td>
    <td>
	<%if @reportType=="Inactive Bikes"%>
		<%= link_to 'View', bike %></td>
	<%elsif @reportType=="Inactive EABs"%>
		<a href="/eab_projects/<%=@project.id%>">View</a>
	<%end%>

  </tr>
<% @count = @count + 1%>
<% end %>
</tbody>
</table>
<br/><div id="reportMsg">
<%if @reportType =="Inactive Bikes"%>
	Report was generated by taking bikes with either status: 'Available, In-Shop, Other' 
	and has Date In longer than the period; or bikes that were last updated longer than the period. Bikes that are sold or departed are not included.

<%elsif @reportType =="Inactive EABs" %>	
	Report was generated by taking projects had a start date longer than the period. Projects with statuses 'Bike signed off' and 'Abandoned' are not included.
<%end%>
</div>
<%else%>
No Results found.
<%end%>
<%end%>
<br/>

<br/>
